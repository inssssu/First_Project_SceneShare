<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>spring project Scene, Share</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
          crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/css/common.css">
  <script src="/js/common.js"></script>

</head>
<body>
<div class="wrap">

  <header th:replace="~{/user/layout/header :: headerBasic('리뷰(게시글) 상세보기')}"></header>


  <main>
    <div class="container page-bottom">

      <form id="frm" method="post">
        <div class="review-box grey">
          <!-- hidden 값 정리 -->
          <input type="hidden" name="boardId"    th:value="${board.boardId}">
          <input type="hidden" name="userId"     th:value="${board.userId}">
          <input type="hidden" name="movieId"    th:value="${board.movieId}">
          <input type="hidden" name="title"      th:value="${board.title}">
          <input type="hidden" name="contents"   th:value="${board.contents}">
          <input type="hidden" name="rating"     th:value="${board.rating}">
          <input type="hidden" name="createDate" th:value="${board.createDate}">
          <input type="hidden" name="updateDate" th:value="${board.updateDate}">
          <input type="hidden" name="genre"      th:value="${board.genre}">
          <input type="hidden" name="reply"      th:value="${board.reply}">

          <!-- 상단 -->
          <div class="top">
            <h6>
              <!-- 프로필 이미지: 유저 이미지 없으면 기본 -->
              <img th:if="${board.userImg != null}"
                   th:src="@{'/img/profile/' + ${board.userImg}}" class="profile-img" alt="profile">
              <img th:unless="${board.userImg != null}"
                   th:src="@{/img/profile_img_bg.svg}" class="profile-img" alt="profile">

              <span th:text="${board.userId}">userId</span>
              <small class="date" th:text="${#temporals.format(board.createDate, 'yyyy-MM-dd')}"></small>
            </h6>
            <div class="star-view">
              <img src="/img/star_icon.svg" alt="star">
              <span th:text="${board.rating != null ? board.rating : 0}">0</span>
            </div>
          </div>

          <!-- 가운데: 영화정보 + 포스터 -->
          <div class="center"
               th:with="
       posterSafe=${movie != null
         ? (#strings.isEmpty(movie.posterUrl)
             ? (#strings.isEmpty(movie.moviePosterUrl) ? '/img/no-image.png' : movie.moviePosterUrl)
             : movie.posterUrl)
         : '/img/no-image.png'},
       yearText=${movie != null && movie.releaseDate != null ? #temporals.format(movie.releaseDate,'yyyy') : ''},
       genreText=${movie != null && movie.movieGenre != null ? movie.movieGenre : '장르 미정'},
       countryText=${movie != null && movie.movieCountry != null ? movie.movieCountry : ''},
       timeText=${movie != null && movie.movieTime != null ? movie.movieTime : ''},
       ageText=${movie != null && movie.movieAge != null ? movie.movieAge : ''}
     ">
            <figure class="imgBox">
              <img th:src="${posterSafe}" alt="영화 포스터">
            </figure>
            <div class="infor">
              <h5 class="in-title" th:text="${movie != null ? movie.movieTitle : '(제목 없음)'}">movieTitle</h5>
              <p class="in-row1">
                <span th:text="${yearText}">2025</span>
                &#183;
                <span th:text="${genreText}">장르</span>
                &#183;
                <span th:text="${countryText}">국가</span>
              </p>
              <p class="in-row2">
                <span th:text="${timeText}">러닝타임</span>
                &#183;
                <span th:text="${ageText}">관람등급</span>
              </p>
            </div>
          </div>

          <!-- 리뷰 본문 -->
          <p class="review-all" th:text="${board.contents}"></p>

          <!-- 하단: 댓글 수 + 버튼 -->
          <div class="bottom">
            <p class="reply">댓글 <em th:text="${replyCount}">0</em></p>
            <div class="btn-area">
              <button type="button" class="btn-re-write" onclick="location.href='#popup_re_write';">댓글</button>
              <button type="button" class="btn-update"  onclick="location.href='#popup_update';">수정</button>
              <button type="button" class="btn-delete"  onclick="location.href='#popup_delete';">삭제</button>
            </div>
          </div>
        </div>
      </form>

      <!-- (선택) 댓글 목록을 실제로 출력하고 싶다면 -->
      <div class="reply-list" th:if="${replies != null}">
        <div class="reply-box" th:each="r : ${replies}">
          <h6 class="re-user-id">
            <img src="/img/profile_img_bg.svg" class="profile-img" alt="프로필 이미지">
            <span th:text="${r.userId}">user</span>
            <small class="re-date" th:text="${#temporals.format(r.createDate, 'yyyy-MM-dd')}"></small>
          </h6>
          <div class="re-text" th:text="${r.contents}"></div>
          <div class="re-btn-area">
            <button type="button" class="btn-re-update" onclick="location.href='#popup_re_update';">수정</button>
            <span></span>
            <button type="button" class="btn-re-delete" onclick="location.href='#popup_re_delete';">삭제</button>
          </div>
        </div>
      </div>
    </div>
  </main>


  <!-- 리뷰 수정 팝업 -->
  <div class="overlay_flight" id="popup_update">
    <div class="pop_con">
      <div class="pop_header">
        <h5 class="pop_title"></h5>
        <button type="button" class="btn_close" onclick="location.href='#';"></button>
      </div>
      <div class="pop_input">
        <div class="rating">
          <label class="rating__label rating__label--half" for="starhalf">
            <input type="radio" id="starhalf" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--full" for="star1">
            <input type="radio" id="star1" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--half" for="star1half">
            <input type="radio" id="star1half" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--full" for="star2">
            <input type="radio" id="star2" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--half" for="star2half">
            <input type="radio" id="star2half" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--full" for="star3">
            <input type="radio" id="star3" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--half" for="star3half">
            <input type="radio" id="star3half" class="rating__input" name="rating" checked>
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--full" for="star4">
            <input type="radio" id="star4" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--half" for="star4half">
            <input type="radio" id="star4half" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
          <label class="rating__label rating__label--full" for="star5">
            <input type="radio" id="star5" class="rating__input" name="rating" value="">
            <span class="star-icon"></span>
          </label>
        </div>

        <textarea class="contents" maxlength="10000" placeholder="이 작품에 대한 생각을 자유롭게 표현해주세요."></textarea>
      </div>
      <div class="pop_footer">
        <div class="counter">
          <span class="charCount">0</span> / 10000
        </div>
        <button type="submit" class="save">수정</button>
      </div>
    </div>
  </div>


  <!-- 리뷰 삭제 팝업 -->
  <div class="overlay_flight" id="popup_delete">
    <div class="pop_con comfirm">
      <div class="pop_message">
        <h5>알림</h5>
        <p>리뷰를 삭제하시겠습니까?</p>
      </div>
      <div class="pop_btns">
        <button type="button" class="btn_cancel" onclick="location.href='#';">취소</button>
        <button type="button" class="btn_delete" onclick="location.href='#';">확인</button>
      </div>
    </div>
  </div>


  <!-- 댓글 쓰기 팝업 -->
  <div class="overlay_flight" id="popup_re_write">
    <div class="pop_con">
      <div class="pop_header">
        <h5 class="pop_title">댓글</h5>
        <button type="button" class="btn_close" onclick="location.href='#';"></button>
      </div>
      <div class="pop_input">
        <div class="rating"></div>

        <textarea class="contents" maxlength="10000" placeholder="이 작품에 대한 생각을 자유롭게 표현해주세요."></textarea>
      </div>
      <div class="pop_footer">
        <div class="counter">
          <span class="charCount">0</span> / 10000
        </div>
        <button type="submit" class="save">저장</button>
      </div>
    </div>
  </div>


  <!-- 댓글 수정 팝업 -->
  <div class="overlay_flight" id="popup_re_update">
    <div class="pop_con">
      <div class="pop_header">
        <h5 class="pop_title">댓글</h5>
        <button type="button" class="btn_close" onclick="location.href='#';"></button>
      </div>
      <div class="pop_input">
        <div class="rating"></div>

        <textarea class="contents" maxlength="10000" placeholder="이 작품에 대한 생각을 자유롭게 표현해주세요."></textarea>
      </div>
      <div class="pop_footer">
        <div class="counter">
          <span class="charCount">0</span> / 10000
        </div>
        <button type="submit" class="save">수정</button>
      </div>
    </div>
  </div>


  <!-- 댓글 삭제 팝업 -->
  <div class="overlay_flight" id="popup_re_delete">
    <div class="pop_con comfirm">
      <div class="pop_message">
        <h5>알림</h5>
        <p>댓글을 삭제하시겠습니까?</p>
      </div>
      <div class="pop_btns">
        <button type="button" class="btn_cancel" onclick="location.href='#';">취소</button>
        <button type="button" class="btn_delete" onclick="location.href='#';">확인</button>
      </div>
    </div>
  </div>


  <footer th:replace="~{/user/layout/footer :: footer}"></footer>

</div>
</body>
</html>